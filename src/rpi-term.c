#include <stdlib.h>
#include <string.h>
#include <stdio.h>

#include "rpi-term.h"

uint8_t fb_ready = 0;
static volatile uint32_t* fb;
static int fb_width;
static int fb_height;

static int cursor_x;
static int cursor_y;

uint32_t foreground_color, background_color;

// bytes are rows top-to-bottom
// bits are columns right-to-left
unsigned char font[256][8] = {
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    { 0x00, 0x0a, 0x0a, 0x00, 0x11, 0x0e, 0x00, 0x00 },
    { 0x3e, 0x6b, 0x6b, 0x7f, 0x5d, 0x63, 0x3e, 0x00 },
    { 0x00, 0x0a, 0x1f, 0x1f, 0x1f, 0x0e, 0x04, 0x00 },
    { 0x00, 0x04, 0x0e, 0x1f, 0x1f, 0x0e, 0x04, 0x00 },
    { 0x04, 0x0e, 0x04, 0x1f, 0x1f, 0x04, 0x0e, 0x00 },
    { 0x00, 0x04, 0x0e, 0x1f, 0x1f, 0x04, 0x0e, 0x00 },
    { 0x00, 0x0e, 0x11, 0x11, 0x11, 0x0e, 0x00, 0x00 },
    { 0x1c, 0x18, 0x17, 0x05, 0x07, 0x02, 0x07, 0x02 },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    { 0x00, 0x1c, 0x18, 0x16, 0x09, 0x09, 0x06, 0x00 },
    { 0x0e, 0x11, 0x11, 0x11, 0x0e, 0x04, 0x0e, 0x04 },
    { 0x0c, 0x1c, 0x14, 0x04, 0x04, 0x07, 0x07, 0x00 },
    { 0x70, 0x4c, 0x44, 0x44, 0x74, 0x77, 0x07, 0x00 },
    { 0x89, 0x42, 0x18, 0xbc, 0x3d, 0x18, 0x42, 0x91 },
    { 0x00, 0x03, 0x0f, 0x3f, 0x0f, 0x03, 0x00, 0x00 },
    { 0x00, 0x30, 0x3c, 0x3f, 0x3c, 0x30, 0x00, 0x00 },
    { 0x04, 0x0e, 0x1f, 0x04, 0x04, 0x1f, 0x0e, 0x04 },
    { 0x12, 0x12, 0x12, 0x12, 0x12, 0x00, 0x12, 0x00 },
    { 0x1e, 0x15, 0x15, 0x16, 0x14, 0x14, 0x14, 0x00 },
    { 0x1e, 0x03, 0x0d, 0x11, 0x16, 0x18, 0x0f, 0x00 },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x1e, 0x00 },
    { 0x04, 0x0e, 0x1f, 0x04, 0x1f, 0x0e, 0x04, 0x1f },
    { 0x04, 0x0e, 0x1f, 0x04, 0x04, 0x04, 0x04, 0x00 },
    { 0x04, 0x04, 0x04, 0x04, 0x1f, 0x0e, 0x04, 0x00 },
    { 0x00, 0x10, 0x30, 0x7f, 0x30, 0x10, 0x00, 0x00 },
    { 0x00, 0x04, 0x06, 0x7f, 0x06, 0x04, 0x00, 0x00 },
    { 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x1f, 0x00 },
    { 0x00, 0x24, 0x66, 0xff, 0x66, 0x24, 0x00, 0x00 },
    { 0x00, 0x04, 0x04, 0x0e, 0x0e, 0x1f, 0x1f, 0x00 },
    { 0x00, 0x1f, 0x1f, 0x0e, 0x0e, 0x04, 0x04, 0x00 },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    { 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x01, 0x00 },
    { 0x0a, 0x0a, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00 },
    { 0x0a, 0x0a, 0x1f, 0x0a, 0x1f, 0x0a, 0x0a, 0x00 },
    { 0x04, 0x1e, 0x01, 0x0e, 0x10, 0x0f, 0x04, 0x00 },
    { 0x11, 0x09, 0x08, 0x04, 0x02, 0x12, 0x11, 0x00 },
    { 0x04, 0x0a, 0x04, 0x16, 0x0d, 0x09, 0x16, 0x00 },
    { 0x02, 0x02, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00 },
    { 0x0c, 0x02, 0x01, 0x01, 0x01, 0x02, 0x0c, 0x00 },
    { 0x03, 0x04, 0x08, 0x08, 0x08, 0x04, 0x03, 0x00 },
    { 0x00, 0x00, 0x09, 0x06, 0x09, 0x00, 0x00, 0x00 },
    { 0x00, 0x04, 0x04, 0x1f, 0x04, 0x04, 0x00, 0x00 },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01 },
    { 0x00, 0x00, 0x00, 0x1f, 0x00, 0x00, 0x00, 0x00 },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x00 },
    { 0x10, 0x08, 0x08, 0x04, 0x02, 0x02, 0x01, 0x00 },
    { 0x0e, 0x11, 0x19, 0x15, 0x13, 0x11, 0x0e, 0x00 },
    { 0x04, 0x06, 0x04, 0x04, 0x04, 0x04, 0x1f, 0x00 },
    { 0x0e, 0x11, 0x10, 0x0c, 0x02, 0x11, 0x1f, 0x00 },
    { 0x0e, 0x11, 0x10, 0x0c, 0x10, 0x11, 0x0e, 0x00 },
    { 0x18, 0x14, 0x12, 0x11, 0x1f, 0x10, 0x10, 0x00 },
    { 0x1f, 0x01, 0x0f, 0x10, 0x10, 0x11, 0x0e, 0x00 },
    { 0x0c, 0x02, 0x01, 0x0f, 0x11, 0x11, 0x0e, 0x00 },
    { 0x1f, 0x11, 0x10, 0x08, 0x04, 0x04, 0x04, 0x00 },
    { 0x0e, 0x11, 0x11, 0x0e, 0x11, 0x11, 0x0e, 0x00 },
    { 0x0e, 0x11, 0x11, 0x1e, 0x10, 0x08, 0x06, 0x00 },
    { 0x00, 0x02, 0x02, 0x00, 0x00, 0x02, 0x02, 0x00 },
    { 0x00, 0x02, 0x02, 0x00, 0x00, 0x02, 0x02, 0x01 },
    { 0x08, 0x04, 0x02, 0x01, 0x02, 0x04, 0x08, 0x00 },
    { 0x00, 0x00, 0x1f, 0x00, 0x00, 0x1f, 0x00, 0x00 },
    { 0x01, 0x02, 0x04, 0x08, 0x04, 0x02, 0x01, 0x00 },
    { 0x0e, 0x11, 0x10, 0x08, 0x04, 0x00, 0x04, 0x00 },
    { 0x1e, 0x21, 0x2d, 0x2d, 0x3d, 0x01, 0x1e, 0x00 },
    { 0x0e, 0x11, 0x1f, 0x11, 0x11, 0x11, 0x11, 0x00 },
    { 0x0f, 0x11, 0x0f, 0x11, 0x11, 0x11, 0x0f, 0x00 },
    { 0x0e, 0x11, 0x01, 0x01, 0x01, 0x11, 0x0e, 0x00 },
    { 0x0f, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0f, 0x00 },
    { 0x1f, 0x01, 0x07, 0x01, 0x01, 0x01, 0x1f, 0x00 },
    { 0x1f, 0x01, 0x07, 0x01, 0x01, 0x01, 0x01, 0x00 },
    { 0x1e, 0x01, 0x19, 0x11, 0x11, 0x11, 0x0e, 0x00 },
    { 0x11, 0x11, 0x1f, 0x11, 0x11, 0x11, 0x11, 0x00 },
    { 0x07, 0x02, 0x02, 0x02, 0x02, 0x02, 0x07, 0x00 },
    { 0x10, 0x10, 0x10, 0x10, 0x10, 0x11, 0x0e, 0x00 },
    { 0x11, 0x09, 0x07, 0x09, 0x11, 0x11, 0x11, 0x00 },
    { 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x1f, 0x00 },
    { 0x11, 0x1b, 0x15, 0x11, 0x11, 0x11, 0x11, 0x00 },
    { 0x11, 0x13, 0x15, 0x19, 0x11, 0x11, 0x11, 0x00 },
    { 0x0e, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0e, 0x00 },
    { 0x0f, 0x11, 0x0f, 0x01, 0x01, 0x01, 0x01, 0x00 },
    { 0x0e, 0x11, 0x11, 0x11, 0x11, 0x09, 0x16, 0x00 },
    { 0x0f, 0x11, 0x0f, 0x11, 0x11, 0x11, 0x11, 0x00 },
    { 0x1e, 0x01, 0x0e, 0x10, 0x10, 0x11, 0x0e, 0x00 },
    { 0x1f, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x00 },
    { 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0e, 0x00 },
    { 0x11, 0x11, 0x11, 0x11, 0x0a, 0x0a, 0x04, 0x00 },
    { 0x11, 0x11, 0x11, 0x11, 0x15, 0x1b, 0x11, 0x00 },
    { 0x11, 0x0a, 0x04, 0x0a, 0x11, 0x11, 0x11, 0x00 },
    { 0x11, 0x0a, 0x04, 0x04, 0x04, 0x04, 0x04, 0x00 },
    { 0x1f, 0x10, 0x08, 0x04, 0x02, 0x01, 0x1f, 0x00 },
    { 0x07, 0x01, 0x01, 0x01, 0x01, 0x01, 0x07, 0x00 },
    { 0x01, 0x02, 0x02, 0x04, 0x08, 0x08, 0x10, 0x00 },
    { 0x07, 0x04, 0x04, 0x04, 0x04, 0x04, 0x07, 0x00 },
    { 0x04, 0x0a, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00 },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1f },
    { 0x01, 0x01, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00 },
    { 0x00, 0x00, 0x0e, 0x10, 0x1e, 0x11, 0x1e, 0x00 },
    { 0x01, 0x01, 0x0d, 0x13, 0x11, 0x11, 0x0f, 0x00 },
    { 0x00, 0x00, 0x0e, 0x11, 0x01, 0x11, 0x0e, 0x00 },
    { 0x10, 0x10, 0x16, 0x19, 0x11, 0x11, 0x1e, 0x00 },
    { 0x00, 0x00, 0x0e, 0x11, 0x1f, 0x01, 0x1e, 0x00 },
    { 0x0c, 0x02, 0x0f, 0x02, 0x02, 0x02, 0x02, 0x00 },
    { 0x00, 0x00, 0x1e, 0x11, 0x11, 0x1e, 0x10, 0x0f },
    { 0x01, 0x01, 0x0d, 0x13, 0x11, 0x11, 0x11, 0x00 },
    { 0x01, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00 },
    { 0x10, 0x00, 0x10, 0x10, 0x10, 0x11, 0x11, 0x0e },
    { 0x01, 0x01, 0x09, 0x05, 0x03, 0x05, 0x09, 0x00 },
    { 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x02, 0x00 },
    { 0x00, 0x00, 0x0b, 0x15, 0x15, 0x11, 0x11, 0x00 },
    { 0x00, 0x00, 0x0f, 0x11, 0x11, 0x11, 0x11, 0x00 },
    { 0x00, 0x00, 0x0e, 0x11, 0x11, 0x11, 0x0e, 0x00 },
    { 0x00, 0x00, 0x0d, 0x13, 0x11, 0x0f, 0x01, 0x01 },
    { 0x00, 0x00, 0x16, 0x19, 0x11, 0x1e, 0x10, 0x10 },
    { 0x00, 0x00, 0x0d, 0x13, 0x01, 0x01, 0x01, 0x00 },
    { 0x00, 0x00, 0x1e, 0x01, 0x0e, 0x10, 0x0f, 0x00 },
    { 0x02, 0x02, 0x07, 0x02, 0x02, 0x02, 0x04, 0x00 },
    { 0x00, 0x00, 0x11, 0x11, 0x11, 0x11, 0x1e, 0x00 },
    { 0x00, 0x00, 0x11, 0x11, 0x11, 0x0a, 0x04, 0x00 },
    { 0x00, 0x00, 0x11, 0x11, 0x15, 0x15, 0x1e, 0x00 },
    { 0x00, 0x00, 0x11, 0x0a, 0x04, 0x0a, 0x11, 0x00 },
    { 0x00, 0x00, 0x11, 0x11, 0x11, 0x1e, 0x10, 0x0f },
    { 0x00, 0x00, 0x1f, 0x08, 0x04, 0x02, 0x1f, 0x00 },
    { 0x0c, 0x02, 0x02, 0x01, 0x02, 0x02, 0x0c, 0x00 },
    { 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00 },
    { 0x03, 0x04, 0x04, 0x08, 0x04, 0x04, 0x03, 0x00 },
    { 0x26, 0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    { 0x00, 0x00, 0x04, 0x0a, 0x11, 0x11, 0x1f, 0x00 },
    { 0x0e, 0x11, 0x01, 0x01, 0x11, 0x0e, 0x10, 0x0c },
    { 0x0a, 0x00, 0x11, 0x11, 0x11, 0x11, 0x1e, 0x00 },
    { 0x18, 0x00, 0x0e, 0x11, 0x1f, 0x01, 0x1e, 0x00 },
    { 0x0e, 0x11, 0x0e, 0x10, 0x1e, 0x11, 0x1e, 0x00 },
    { 0x0a, 0x00, 0x0e, 0x10, 0x1e, 0x11, 0x1e, 0x00 },
    { 0x03, 0x00, 0x0e, 0x10, 0x1e, 0x11, 0x1e, 0x00 },
    { 0x04, 0x00, 0x0e, 0x10, 0x1e, 0x11, 0x1e, 0x00 },
    { 0x00, 0x0e, 0x11, 0x01, 0x11, 0x0e, 0x10, 0x0c },
    { 0x0e, 0x11, 0x0e, 0x11, 0x1f, 0x01, 0x1e, 0x00 },
    { 0x0a, 0x00, 0x0e, 0x11, 0x1f, 0x01, 0x1e, 0x00 },
    { 0x03, 0x00, 0x0e, 0x11, 0x1f, 0x01, 0x1e, 0x00 },
    { 0x05, 0x00, 0x02, 0x02, 0x02, 0x02, 0x02, 0x00 },
    { 0x0e, 0x11, 0x04, 0x04, 0x04, 0x04, 0x04, 0x00 },
    { 0x03, 0x00, 0x02, 0x02, 0x02, 0x02, 0x02, 0x00 },
    { 0x11, 0x0e, 0x11, 0x1f, 0x11, 0x11, 0x11, 0x00 },
    { 0x04, 0x00, 0x0e, 0x11, 0x1f, 0x11, 0x11, 0x00 },
    { 0x18, 0x00, 0x1f, 0x01, 0x07, 0x01, 0x1f, 0x00 },
    { 0x00, 0x00, 0x36, 0x48, 0x7e, 0x09, 0x7e, 0x00 },
    { 0x7e, 0x09, 0x3f, 0x09, 0x09, 0x09, 0x79, 0x00 },
    { 0x0e, 0x11, 0x0e, 0x11, 0x11, 0x11, 0x0e, 0x00 },
    { 0x0a, 0x00, 0x0e, 0x11, 0x11, 0x11, 0x0e, 0x00 },
    { 0x03, 0x00, 0x0e, 0x11, 0x11, 0x11, 0x0e, 0x00 },
    { 0x0e, 0x11, 0x00, 0x11, 0x11, 0x11, 0x1e, 0x00 },
    { 0x03, 0x00, 0x11, 0x11, 0x11, 0x11, 0x1e, 0x00 },
    { 0x0a, 0x00, 0x11, 0x11, 0x11, 0x1e, 0x10, 0x0f },
    { 0x11, 0x0e, 0x11, 0x11, 0x11, 0x11, 0x0e, 0x00 },
    { 0x11, 0x00, 0x11, 0x11, 0x11, 0x11, 0x0e, 0x00 },
    { 0x00, 0x00, 0x0e, 0x19, 0x15, 0x13, 0x0e, 0x04 },
    { 0x0c, 0x12, 0x02, 0x0f, 0x02, 0x02, 0x1f, 0x00 },
    { 0x11, 0x0a, 0x04, 0x1f, 0x04, 0x1f, 0x04, 0x00 },
    { 0x20, 0x48, 0x52, 0x53, 0x53, 0x52, 0x48, 0x20 },
    { 0x18, 0x24, 0x5a, 0x5a, 0x5a, 0x24, 0x18, 0x00 },
    { 0x18, 0x00, 0x0e, 0x10, 0x1e, 0x11, 0x1e, 0x00 },
    { 0x03, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00 },
    { 0x18, 0x00, 0x0e, 0x11, 0x11, 0x11, 0x0e, 0x00 },
    { 0x18, 0x00, 0x11, 0x11, 0x11, 0x11, 0x1e, 0x00 },
    { 0x1f, 0x00, 0x0f, 0x11, 0x11, 0x11, 0x11, 0x00 },
    { 0x1f, 0x00, 0x11, 0x13, 0x15, 0x19, 0x11, 0x00 },
    { 0x0e, 0x10, 0x1f, 0x1e, 0x00, 0x1f, 0x00, 0x00 },
    { 0x0e, 0x11, 0x11, 0x0e, 0x00, 0x1f, 0x00, 0x00 },
    { 0x04, 0x00, 0x04, 0x02, 0x01, 0x11, 0x0e, 0x00 },
    { 0x1c, 0x22, 0x5d, 0x45, 0x5d, 0x22, 0x1c, 0x00 },
    { 0x1c, 0x2a, 0x55, 0x4d, 0x55, 0x22, 0x1c, 0x00 },
    { 0x11, 0x09, 0x08, 0x24, 0x42, 0x22, 0x71, 0x00 },
    { 0x11, 0x09, 0x08, 0x04, 0x52, 0x72, 0x41, 0x00 },
    { 0x00, 0x01, 0x00, 0x01, 0x01, 0x01, 0x01, 0x00 },
    { 0x00, 0x14, 0x0a, 0x05, 0x0a, 0x14, 0x00, 0x00 },
    { 0x00, 0x05, 0x0a, 0x14, 0x0a, 0x05, 0x00, 0x00 },
    { 0x44, 0x11, 0x44, 0x11, 0x44, 0x11, 0x44, 0x11 },
    { 0xaa, 0x55, 0xaa, 0x55, 0xaa, 0x55, 0xaa, 0x55 },
    { 0xdb, 0xee, 0xdb, 0x77, 0xdb, 0xee, 0xdb, 0x77 },
    { 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18 },
    { 0x18, 0x18, 0x18, 0x18, 0x1f, 0x18, 0x18, 0x18 },
    { 0x18, 0x18, 0x1f, 0x18, 0x1f, 0x18, 0x18, 0x18 },
    { 0x6c, 0x6c, 0x6c, 0x6c, 0x6f, 0x6c, 0x6c, 0x6c },
    { 0x00, 0x00, 0x00, 0x00, 0x7f, 0x6c, 0x6c, 0x6c },
    { 0x00, 0x00, 0x1f, 0x18, 0x1f, 0x18, 0x18, 0x18 },
    { 0x6c, 0x6c, 0x6f, 0x60, 0x6f, 0x6c, 0x6c, 0x6c },
    { 0x6c, 0x6c, 0x6c, 0x6c, 0x6c, 0x6c, 0x6c, 0x6c },
    { 0x00, 0x00, 0x7f, 0x60, 0x6f, 0x6c, 0x6c, 0x6c },
    { 0x6c, 0x6c, 0x6f, 0x60, 0x7f, 0x00, 0x00, 0x00 },
    { 0x6c, 0x6c, 0x6c, 0x6c, 0x7f, 0x00, 0x00, 0x00 },
    { 0x18, 0x18, 0x1f, 0x18, 0x1f, 0x00, 0x00, 0x00 },
    { 0x00, 0x00, 0x00, 0x00, 0x1f, 0x18, 0x18, 0x18 },
    { 0x18, 0x18, 0x18, 0x18, 0xf8, 0x00, 0x00, 0x00 },
    { 0x18, 0x18, 0x18, 0x18, 0xff, 0x00, 0x00, 0x00 },
    { 0x00, 0x00, 0x00, 0x00, 0xff, 0x18, 0x18, 0x18 },
    { 0x18, 0x18, 0x18, 0x18, 0xf8, 0x18, 0x18, 0x18 },
    { 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00 },
    { 0x18, 0x18, 0x18, 0x18, 0xff, 0x18, 0x18, 0x18 },
    { 0x18, 0x18, 0xf8, 0x18, 0xf8, 0x18, 0x18, 0x18 },
    { 0x6c, 0x6c, 0x6c, 0x6c, 0xec, 0x6c, 0x6c, 0x6c },
    { 0x6c, 0x6c, 0xec, 0x0c, 0xfc, 0x00, 0x00, 0x00 },
    { 0x00, 0x00, 0xfc, 0x0c, 0xec, 0x6c, 0x6c, 0x6c },
    { 0x6c, 0x6c, 0xef, 0x00, 0xff, 0x00, 0x00, 0x00 },
    { 0x00, 0x00, 0xff, 0x00, 0xef, 0x6c, 0x6c, 0x6c },
    { 0x6c, 0x6c, 0xec, 0x0c, 0xec, 0x6c, 0x6c, 0x6c },
    { 0x00, 0x00, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00 },
    { 0x6c, 0x6c, 0xef, 0x00, 0xef, 0x6c, 0x6c, 0x6c },
    { 0x18, 0x18, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00 },
    { 0x6c, 0x6c, 0x6c, 0x6c, 0xff, 0x00, 0x00, 0x00 },
    { 0x00, 0x00, 0xff, 0x00, 0xff, 0x18, 0x18, 0x18 },
    { 0x00, 0x00, 0x00, 0x00, 0xff, 0x6c, 0x6c, 0x6c },
    { 0x6c, 0x6c, 0x6c, 0x6c, 0xfc, 0x00, 0x00, 0x00 },
    { 0x18, 0x18, 0xf8, 0x18, 0xf8, 0x00, 0x00, 0x00 },
    { 0x00, 0x00, 0xf8, 0x18, 0xf8, 0x18, 0x18, 0x18 },
    { 0x00, 0x00, 0x00, 0x00, 0xfc, 0x6c, 0x6c, 0x6c },
    { 0x6c, 0x6c, 0x6c, 0x6c, 0xff, 0x6c, 0x6c, 0x6c },
    { 0x18, 0x18, 0xff, 0x18, 0xff, 0x18, 0x18, 0x18 },
    { 0x18, 0x18, 0x18, 0x18, 0x1f, 0x00, 0x00, 0x00 },
    { 0x00, 0x00, 0x00, 0x00, 0xf8, 0x18, 0x18, 0x18 },
    { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff },
    { 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff },
    { 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f, 0x0f },
    { 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0, 0xf0 },
    { 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00 },
    { 0x00, 0x00, 0x16, 0x09, 0x09, 0x09, 0x16, 0x00 },
    { 0x06, 0x09, 0x05, 0x09, 0x11, 0x11, 0x0f, 0x01 },
    { 0x1f, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00 },
    { 0x00, 0x00, 0x1f, 0x0a, 0x0a, 0x0a, 0x0a, 0x00 },
    { 0x1f, 0x01, 0x02, 0x04, 0x02, 0x01, 0x1f, 0x00 },
    { 0x00, 0x00, 0x3e, 0x11, 0x11, 0x11, 0x0e, 0x00 },
    { 0x00, 0x11, 0x11, 0x11, 0x11, 0x0f, 0x01, 0x00 },
    { 0x00, 0x00, 0x1f, 0x04, 0x04, 0x04, 0x08, 0x00 },
    { 0x04, 0x0e, 0x15, 0x15, 0x15, 0x0e, 0x04, 0x00 },
    { 0x0e, 0x11, 0x11, 0x1f, 0x11, 0x11, 0x0e, 0x00 },
    { 0x0e, 0x11, 0x11, 0x11, 0x11, 0x0a, 0x1b, 0x00 },
    { 0x0c, 0x02, 0x04, 0x0a, 0x11, 0x11, 0x0e, 0x00 },
    { 0x00, 0x00, 0x36, 0x49, 0x49, 0x36, 0x00, 0x00 },
    { 0x00, 0x08, 0x15, 0x15, 0x15, 0x0e, 0x04, 0x00 },
    { 0x00, 0x00, 0x1e, 0x01, 0x06, 0x01, 0x1e, 0x00 },
    { 0x0e, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x00 },
    { 0x00, 0x3f, 0x00, 0x3f, 0x00, 0x3f, 0x00, 0x00 },
    { 0x04, 0x04, 0x1f, 0x04, 0x04, 0x00, 0x1f, 0x00 },
    { 0x02, 0x04, 0x08, 0x04, 0x02, 0x00, 0x1f, 0x00 },
    { 0x08, 0x04, 0x02, 0x04, 0x08, 0x00, 0x1f, 0x00 },
    { 0x30, 0x48, 0x48, 0x08, 0x08, 0x08, 0x08, 0x08 },
    { 0x08, 0x08, 0x08, 0x08, 0x08, 0x09, 0x09, 0x06 },
    { 0x00, 0x04, 0x00, 0x1f, 0x00, 0x04, 0x00, 0x00 },
    { 0x00, 0x26, 0x19, 0x00, 0x26, 0x19, 0x00, 0x00 },
    { 0x06, 0x09, 0x09, 0x06, 0x00, 0x00, 0x00, 0x00 },
    { 0x08, 0x1c, 0x7f, 0x7f, 0x3e, 0x36, 0x22, 0x00 },
    { 0x00, 0x00, 0x00, 0x18, 0x18, 0x00, 0x00, 0x00 },
    { 0x38, 0x08, 0x08, 0x08, 0x09, 0x0a, 0x0c, 0x00 },
    { 0x00, 0x07, 0x09, 0x09, 0x09, 0x00, 0x00, 0x00 },
    { 0x06, 0x09, 0x04, 0x02, 0x0f, 0x00, 0x00, 0x00 },
    { 0x00, 0x1f, 0x1f, 0x1f, 0x1f, 0x1f, 0x00, 0x00 },
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
};

// this is probably horrible C code, but my OOP brain can't figure out how else to do this :/
void RPI_TermInit(volatile uint32_t* in_fb, int width, int height) {
    fb = in_fb;
    fb_width = width;
    fb_height = height;

    RPI_TermSetCursorPos(0, 0);
    RPI_TermSetTextColor(COLORS_WHITE);
    RPI_TermSetBackgroundColor(COLORS_BLACK);

    fb_ready = 1;
}

int RPI_TermSetCursorPos(int x, int y) {
    if(x >= 0 && x < fb_width) {
        cursor_x = x;
    } else {
        return -1;
    }
    if(x >= 0 && y < fb_height) {
        cursor_y = y;
    } else {
        return -1;
    }
}

// C can only return 1 variable
int RPI_TermGetCursorX() {
    return cursor_x;
}
int RPI_TermGetCursorY() {
    return cursor_y;
}


void RPI_TermSetTextColor(int color) {
    foreground_color = color;
}
int RPI_TermGetTextColor() {
    return foreground_color;
}

void RPI_TermSetBackgroundColor(int color) {
    background_color = color;
}
int RPI_TermGetBackgroundColor() {
    return background_color;
}

int RPI_TermPutC(char glyph) {
    if(!fb_ready) { // Terminal has not been initalized, printing could(will?) cause a null pointer dereference
        return -1;
    }

    // Handle control characters
    switch(glyph) {
        case '\n':  // Move cursor to start of next line
            cursor_x = 0;
            cursor_y++;
        break;

        case '\t':  // Align cursor to next 4-character boundary
            cursor_x = (cursor_x/4 +1) * 4;
        break;

        default: // Print Glyph, move cursor to right & wrap if neccesary
            {
            int glyph_offset = cursor_y * FONT_HEIGHT * fb_width + cursor_x * FONT_WIDTH;   // Calc offset for whole character

            for( int y = 0; y < FONT_HEIGHT; y++ ) { // Loop through every pixel of the char and put on screen
                for( int x = 0; x < FONT_WIDTH; x++ ) {
                    fb[glyph_offset + y * fb_width + x] = (font[glyph][y] & (1 << x)) ? foreground_color : background_color;
                }
            }

            cursor_x++;
            if(cursor_x > fb_width) {
            	cursor_x = 0;
            	cursor_y++;
            }
            if(cursor_y > fb_height) {
            	cursor_y = 0;	// good enough for now, should scroll screen but :how:, would need buffer for storing printed chars probably
            	// or literally move entire framebuffer up? only usable in text-only mode
            }
            }
        break;
    }


}
